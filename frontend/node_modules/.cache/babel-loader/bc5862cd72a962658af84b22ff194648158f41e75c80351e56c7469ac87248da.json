{"ast":null,"code":"// src/components/MainPage.js\nimport React,{useEffect,useState}from'react';import{useNavigate}from'react-router-dom';import axios from'axios';import ShoppingCartDrawer from'./ShoppingCartDrawer';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";function MainPage(_ref){let{user,searchKeyword,setSearchKeyword}=_ref;const[products,setProducts]=useState([]);const[cartOpen,setCartOpen]=useState(false);const API_BASE_URL=\"/api\";const navigate=useNavigate();// Fetch products on mount\nuseEffect(()=>{axios.get(`${API_BASE_URL}/products`).then(res=>setProducts(res.data)).catch(err=>console.error(\"Failed to fetch products:\",err));},[]);// Handle Buy Now\nconst handleBuyNow=product=>{const quantity=1;axios.post(`${API_BASE_URL}/orders`,{username:user.username,items:[{productId:product.id,quantity}]}).then(()=>{alert(\"Purchase successful!\");return axios.get(`${API_BASE_URL}/products`);}).then(res=>setProducts(res.data)).catch(err=>{var _err$response,_err$response$data;alert(((_err$response=err.response)===null||_err$response===void 0?void 0:(_err$response$data=_err$response.data)===null||_err$response$data===void 0?void 0:_err$response$data.detail)||\"Purchase failed\");});};// Handle Add to Cart\nconst handleAddToCart=product=>{const quantity=1;axios.post(`${API_BASE_URL}/cart`,{username:user.username,productId:product.id,quantity}).then(()=>{setCartOpen(true);}).catch(err=>{var _err$response2,_err$response2$data;return alert(((_err$response2=err.response)===null||_err$response2===void 0?void 0:(_err$response2$data=_err$response2.data)===null||_err$response2$data===void 0?void 0:_err$response2$data.detail)||\"Failed to add to cart\");});};// Filter products based on search\nconst filteredProducts=products.filter(product=>product.name.toLowerCase().includes(searchKeyword.toLowerCase()));return/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white min-h-screen\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"mx-auto max-w-7xl px-4 py-12 sm:px-6 lg:px-8\",children:/*#__PURE__*/_jsx(\"div\",{className:\"grid grid-cols-1 gap-x-6 gap-y-10 sm:grid-cols-2 lg:grid-cols-4 xl:gap-x-8\",children:filteredProducts.map(product=>/*#__PURE__*/_jsxs(\"div\",{className:\"group relative border rounded-lg p-3 shadow hover:shadow-lg transition\",children:[product.imageUrl&&product.imageUrl.endsWith('.pdf')?/*#__PURE__*/_jsx(\"a\",{href:`/api/${product.imageUrl}`,target:\"_blank\",rel:\"noopener noreferrer\",className:\"block text-blue-600 underline text-center py-10\",children:\"View PDF\"}):/*#__PURE__*/_jsx(\"img\",{alt:product.name,src:`api/${product.imageUrl}`,className:\"aspect-square w-full rounded-md bg-gray-200 object-cover group-hover:opacity-75\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-4 flex justify-between\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-sm text-gray-700\",children:product.name}),/*#__PURE__*/_jsxs(\"p\",{className:\"mt-1 text-sm text-gray-500\",children:[\"Category: \",product.category]}),/*#__PURE__*/_jsxs(\"p\",{className:\"mt-1 text-sm text-gray-500\",children:[\"Stock: \",product.stock]}),product.description&&/*#__PURE__*/_jsx(\"p\",{className:\"mt-1 text-xs text-gray-400 line-clamp-2\",children:product.description})]}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-sm font-medium text-gray-900\",children:[\"\\xA5\",product.price]})]}),(user===null||user===void 0?void 0:user.role)!=='merchant'&&/*#__PURE__*/_jsxs(\"div\",{className:\"mt-4 flex space-x-2\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>user?handleAddToCart(product):navigate('/login'),className:\"flex-1 bg-yellow-500 hover:bg-yellow-600 text-white text-xs py-2 px-3 rounded\",children:\"Add to Cart\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>user?handleBuyNow(product):navigate('/login'),className:\"flex-1 bg-blue-600 hover:bg-blue-700 text-white text-xs py-2 px-3 rounded\",children:\"Buy Now\"})]})]},product.id))})}),(user===null||user===void 0?void 0:user.role)==='customer'&&/*#__PURE__*/_jsx(ShoppingCartDrawer,{username:user.username,open:cartOpen,setOpen:setCartOpen})]});}export default MainPage;","map":{"version":3,"names":["React","useEffect","useState","useNavigate","axios","ShoppingCartDrawer","jsx","_jsx","jsxs","_jsxs","MainPage","_ref","user","searchKeyword","setSearchKeyword","products","setProducts","cartOpen","setCartOpen","API_BASE_URL","navigate","get","then","res","data","catch","err","console","error","handleBuyNow","product","quantity","post","username","items","productId","id","alert","_err$response","_err$response$data","response","detail","handleAddToCart","_err$response2","_err$response2$data","filteredProducts","filter","name","toLowerCase","includes","className","children","map","imageUrl","endsWith","href","target","rel","alt","src","category","stock","description","price","role","onClick","open","setOpen"],"sources":["/data/ECSite-demo/frontend/src/components/MainPage.js"],"sourcesContent":["// src/components/MainPage.js\nimport React, { useEffect, useState } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport axios from 'axios';\nimport ShoppingCartDrawer from './ShoppingCartDrawer';\n\nfunction MainPage({ user, searchKeyword, setSearchKeyword }) {\n  const [products, setProducts] = useState([]);\n  const [cartOpen, setCartOpen] = useState(false);\n  const API_BASE_URL = \"/api\";\n\n  const navigate = useNavigate();\n\n  // Fetch products on mount\n  useEffect(() => {\n    axios.get(`${API_BASE_URL}/products`)\n      .then(res => setProducts(res.data))\n      .catch(err => console.error(\"Failed to fetch products:\", err));\n  }, []);\n\n  // Handle Buy Now\n  const handleBuyNow = (product) => {\n    const quantity = 1;\n    axios.post(`${API_BASE_URL}/orders`, {\n      username: user.username,\n      items: [{ productId: product.id, quantity }]\n    })\n      .then(() => {\n        alert(\"Purchase successful!\");\n        return axios.get(`${API_BASE_URL}/products`);\n      })\n      .then(res => setProducts(res.data))\n      .catch(err => {\n        alert(err.response?.data?.detail || \"Purchase failed\");\n      });\n  };\n\n  // Handle Add to Cart\n  const handleAddToCart = (product) => {\n    const quantity = 1;\n    axios.post(`${API_BASE_URL}/cart`, {\n      username: user.username,\n      productId: product.id,\n      quantity\n    })\n      .then(() => {\n        setCartOpen(true);\n      })\n      .catch(err => alert(err.response?.data?.detail || \"Failed to add to cart\"));\n  };\n\n  // Filter products based on search\n  const filteredProducts = products.filter(product =>\n    product.name.toLowerCase().includes(searchKeyword.toLowerCase())\n  );\n\n  return (\n    <div className=\"bg-white min-h-screen\">\n      {/* Product Grid */}\n      <div className=\"mx-auto max-w-7xl px-4 py-12 sm:px-6 lg:px-8\">\n        <div className=\"grid grid-cols-1 gap-x-6 gap-y-10 sm:grid-cols-2 lg:grid-cols-4 xl:gap-x-8\">\n          {filteredProducts.map((product) => (\n            <div\n              key={product.id}\n              className=\"group relative border rounded-lg p-3 shadow hover:shadow-lg transition\"\n            >\n              {/* Product Image or PDF */}\n              {product.imageUrl && product.imageUrl.endsWith('.pdf') ? (\n                <a\n                  href={`/api/${product.imageUrl}`}\n                  target=\"_blank\"\n                  rel=\"noopener noreferrer\"\n                  className=\"block text-blue-600 underline text-center py-10\"\n                >\n                  View PDF\n                </a>\n              ) : (\n                <img\n                  alt={product.name}\n                  src={`api/${product.imageUrl}`}\n                  className=\"aspect-square w-full rounded-md bg-gray-200 object-cover group-hover:opacity-75\"\n                />\n              )}\n\n              {/* Info */}\n              <div className=\"mt-4 flex justify-between\">\n                <div>\n                  <h3 className=\"text-sm text-gray-700\">{product.name}</h3>\n                  <p className=\"mt-1 text-sm text-gray-500\">Category: {product.category}</p>\n                  <p className=\"mt-1 text-sm text-gray-500\">Stock: {product.stock}</p>\n                  {product.description && (\n                    <p className=\"mt-1 text-xs text-gray-400 line-clamp-2\">\n                      {product.description}\n                    </p>\n                  )}\n                </div>\n                <p className=\"text-sm font-medium text-gray-900\">Â¥{product.price}</p>\n              </div>\n\n              {/* Action Buttons */}\n              {user?.role !== 'merchant' && (\n                <div className=\"mt-4 flex space-x-2\">\n                  <button\n                    onClick={() => user ? handleAddToCart(product) : navigate('/login')}\n                    className=\"flex-1 bg-yellow-500 hover:bg-yellow-600 text-white text-xs py-2 px-3 rounded\"\n                  >\n                    Add to Cart\n                  </button>\n                  <button\n                    onClick={() => user ? handleBuyNow(product) : navigate('/login')}\n                    className=\"flex-1 bg-blue-600 hover:bg-blue-700 text-white text-xs py-2 px-3 rounded\"\n                  >\n                    Buy Now\n                  </button>\n                </div>\n              )}\n            </div>\n          ))}\n        </div>\n      </div>\n\n      {/* Shopping Cart Drawer */}\n      {user?.role === 'customer' && (\n        <ShoppingCartDrawer\n          username={user.username}\n          open={cartOpen}\n          setOpen={setCartOpen}\n        />\n      )}\n    </div>\n  );\n}\n\nexport default MainPage;\n"],"mappings":"AAAA;AACA,MAAO,CAAAA,KAAK,EAAIC,SAAS,CAAEC,QAAQ,KAAQ,OAAO,CAClD,OAASC,WAAW,KAAQ,kBAAkB,CAC9C,MAAO,CAAAC,KAAK,KAAM,OAAO,CACzB,MAAO,CAAAC,kBAAkB,KAAM,sBAAsB,CAAC,OAAAC,GAAA,IAAAC,IAAA,CAAAC,IAAA,IAAAC,KAAA,yBAEtD,QAAS,CAAAC,QAAQA,CAAAC,IAAA,CAA4C,IAA3C,CAAEC,IAAI,CAAEC,aAAa,CAAEC,gBAAiB,CAAC,CAAAH,IAAA,CACzD,KAAM,CAACI,QAAQ,CAAEC,WAAW,CAAC,CAAGd,QAAQ,CAAC,EAAE,CAAC,CAC5C,KAAM,CAACe,QAAQ,CAAEC,WAAW,CAAC,CAAGhB,QAAQ,CAAC,KAAK,CAAC,CAC/C,KAAM,CAAAiB,YAAY,CAAG,MAAM,CAE3B,KAAM,CAAAC,QAAQ,CAAGjB,WAAW,CAAC,CAAC,CAE9B;AACAF,SAAS,CAAC,IAAM,CACdG,KAAK,CAACiB,GAAG,CAAC,GAAGF,YAAY,WAAW,CAAC,CAClCG,IAAI,CAACC,GAAG,EAAIP,WAAW,CAACO,GAAG,CAACC,IAAI,CAAC,CAAC,CAClCC,KAAK,CAACC,GAAG,EAAIC,OAAO,CAACC,KAAK,CAAC,2BAA2B,CAAEF,GAAG,CAAC,CAAC,CAClE,CAAC,CAAE,EAAE,CAAC,CAEN;AACA,KAAM,CAAAG,YAAY,CAAIC,OAAO,EAAK,CAChC,KAAM,CAAAC,QAAQ,CAAG,CAAC,CAClB3B,KAAK,CAAC4B,IAAI,CAAC,GAAGb,YAAY,SAAS,CAAE,CACnCc,QAAQ,CAAErB,IAAI,CAACqB,QAAQ,CACvBC,KAAK,CAAE,CAAC,CAAEC,SAAS,CAAEL,OAAO,CAACM,EAAE,CAAEL,QAAS,CAAC,CAC7C,CAAC,CAAC,CACCT,IAAI,CAAC,IAAM,CACVe,KAAK,CAAC,sBAAsB,CAAC,CAC7B,MAAO,CAAAjC,KAAK,CAACiB,GAAG,CAAC,GAAGF,YAAY,WAAW,CAAC,CAC9C,CAAC,CAAC,CACDG,IAAI,CAACC,GAAG,EAAIP,WAAW,CAACO,GAAG,CAACC,IAAI,CAAC,CAAC,CAClCC,KAAK,CAACC,GAAG,EAAI,KAAAY,aAAA,CAAAC,kBAAA,CACZF,KAAK,CAAC,EAAAC,aAAA,CAAAZ,GAAG,CAACc,QAAQ,UAAAF,aAAA,kBAAAC,kBAAA,CAAZD,aAAA,CAAcd,IAAI,UAAAe,kBAAA,iBAAlBA,kBAAA,CAAoBE,MAAM,GAAI,iBAAiB,CAAC,CACxD,CAAC,CAAC,CACN,CAAC,CAED;AACA,KAAM,CAAAC,eAAe,CAAIZ,OAAO,EAAK,CACnC,KAAM,CAAAC,QAAQ,CAAG,CAAC,CAClB3B,KAAK,CAAC4B,IAAI,CAAC,GAAGb,YAAY,OAAO,CAAE,CACjCc,QAAQ,CAAErB,IAAI,CAACqB,QAAQ,CACvBE,SAAS,CAAEL,OAAO,CAACM,EAAE,CACrBL,QACF,CAAC,CAAC,CACCT,IAAI,CAAC,IAAM,CACVJ,WAAW,CAAC,IAAI,CAAC,CACnB,CAAC,CAAC,CACDO,KAAK,CAACC,GAAG,OAAAiB,cAAA,CAAAC,mBAAA,OAAI,CAAAP,KAAK,CAAC,EAAAM,cAAA,CAAAjB,GAAG,CAACc,QAAQ,UAAAG,cAAA,kBAAAC,mBAAA,CAAZD,cAAA,CAAcnB,IAAI,UAAAoB,mBAAA,iBAAlBA,mBAAA,CAAoBH,MAAM,GAAI,uBAAuB,CAAC,GAAC,CAC/E,CAAC,CAED;AACA,KAAM,CAAAI,gBAAgB,CAAG9B,QAAQ,CAAC+B,MAAM,CAAChB,OAAO,EAC9CA,OAAO,CAACiB,IAAI,CAACC,WAAW,CAAC,CAAC,CAACC,QAAQ,CAACpC,aAAa,CAACmC,WAAW,CAAC,CAAC,CACjE,CAAC,CAED,mBACEvC,KAAA,QAAKyC,SAAS,CAAC,uBAAuB,CAAAC,QAAA,eAEpC5C,IAAA,QAAK2C,SAAS,CAAC,8CAA8C,CAAAC,QAAA,cAC3D5C,IAAA,QAAK2C,SAAS,CAAC,4EAA4E,CAAAC,QAAA,CACxFN,gBAAgB,CAACO,GAAG,CAAEtB,OAAO,eAC5BrB,KAAA,QAEEyC,SAAS,CAAC,wEAAwE,CAAAC,QAAA,EAGjFrB,OAAO,CAACuB,QAAQ,EAAIvB,OAAO,CAACuB,QAAQ,CAACC,QAAQ,CAAC,MAAM,CAAC,cACpD/C,IAAA,MACEgD,IAAI,CAAE,QAAQzB,OAAO,CAACuB,QAAQ,EAAG,CACjCG,MAAM,CAAC,QAAQ,CACfC,GAAG,CAAC,qBAAqB,CACzBP,SAAS,CAAC,iDAAiD,CAAAC,QAAA,CAC5D,UAED,CAAG,CAAC,cAEJ5C,IAAA,QACEmD,GAAG,CAAE5B,OAAO,CAACiB,IAAK,CAClBY,GAAG,CAAE,OAAO7B,OAAO,CAACuB,QAAQ,EAAG,CAC/BH,SAAS,CAAC,iFAAiF,CAC5F,CACF,cAGDzC,KAAA,QAAKyC,SAAS,CAAC,2BAA2B,CAAAC,QAAA,eACxC1C,KAAA,QAAA0C,QAAA,eACE5C,IAAA,OAAI2C,SAAS,CAAC,uBAAuB,CAAAC,QAAA,CAAErB,OAAO,CAACiB,IAAI,CAAK,CAAC,cACzDtC,KAAA,MAAGyC,SAAS,CAAC,4BAA4B,CAAAC,QAAA,EAAC,YAAU,CAACrB,OAAO,CAAC8B,QAAQ,EAAI,CAAC,cAC1EnD,KAAA,MAAGyC,SAAS,CAAC,4BAA4B,CAAAC,QAAA,EAAC,SAAO,CAACrB,OAAO,CAAC+B,KAAK,EAAI,CAAC,CACnE/B,OAAO,CAACgC,WAAW,eAClBvD,IAAA,MAAG2C,SAAS,CAAC,yCAAyC,CAAAC,QAAA,CACnDrB,OAAO,CAACgC,WAAW,CACnB,CACJ,EACE,CAAC,cACNrD,KAAA,MAAGyC,SAAS,CAAC,mCAAmC,CAAAC,QAAA,EAAC,MAAC,CAACrB,OAAO,CAACiC,KAAK,EAAI,CAAC,EAClE,CAAC,CAGL,CAAAnD,IAAI,SAAJA,IAAI,iBAAJA,IAAI,CAAEoD,IAAI,IAAK,UAAU,eACxBvD,KAAA,QAAKyC,SAAS,CAAC,qBAAqB,CAAAC,QAAA,eAClC5C,IAAA,WACE0D,OAAO,CAAEA,CAAA,GAAMrD,IAAI,CAAG8B,eAAe,CAACZ,OAAO,CAAC,CAAGV,QAAQ,CAAC,QAAQ,CAAE,CACpE8B,SAAS,CAAC,+EAA+E,CAAAC,QAAA,CAC1F,aAED,CAAQ,CAAC,cACT5C,IAAA,WACE0D,OAAO,CAAEA,CAAA,GAAMrD,IAAI,CAAGiB,YAAY,CAACC,OAAO,CAAC,CAAGV,QAAQ,CAAC,QAAQ,CAAE,CACjE8B,SAAS,CAAC,2EAA2E,CAAAC,QAAA,CACtF,SAED,CAAQ,CAAC,EACN,CACN,GApDIrB,OAAO,CAACM,EAqDV,CACN,CAAC,CACC,CAAC,CACH,CAAC,CAGL,CAAAxB,IAAI,SAAJA,IAAI,iBAAJA,IAAI,CAAEoD,IAAI,IAAK,UAAU,eACxBzD,IAAA,CAACF,kBAAkB,EACjB4B,QAAQ,CAAErB,IAAI,CAACqB,QAAS,CACxBiC,IAAI,CAAEjD,QAAS,CACfkD,OAAO,CAAEjD,WAAY,CACtB,CACF,EACE,CAAC,CAEV,CAEA,cAAe,CAAAR,QAAQ","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}