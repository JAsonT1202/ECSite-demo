{"ast":null,"code":"// src/components/EditProductPage.js\nimport React,{useEffect,useState}from'react';import axios from'axios';import{useNavigate,useParams}from'react-router-dom';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export default function EditProductPage(_ref){let{user}=_ref;const[product,setProduct]=useState(null);const[file,setFile]=useState(null);const[formValues,setFormValues]=useState({name:'',price:'',category:'',stock:'',description:''});const{id}=useParams();const navigate=useNavigate();const API_BASE_URL=\"/api\";useEffect(()=>{axios.get(`${API_BASE_URL}/products`).then(res=>{const target=res.data.find(p=>p.id===parseInt(id));if(!target){alert('Product not found');navigate('/goods');return;}setProduct(target);setFormValues({name:target.name,price:target.price,category:target.category,stock:target.stock,description:target.description||''});}).catch(err=>alert('Failed to load product'));},[id]);const handleChange=e=>{setFormValues({...formValues,[e.target.name]:e.target.value});};const handleSubmit=async e=>{e.preventDefault();try{let imageUrl=null;// 1. Upload file if provided\nif(file){const formData=new FormData();formData.append(\"file\",file);const res=await axios.post(`${API_BASE_URL}/upload-file`,formData,{headers:{'Content-Type':'multipart/form-data'}});imageUrl=res.data.imageUrl;}// 2. Update product info\nconst updatePayload={...formValues,username:user.username};if(imageUrl){updatePayload.imageUrl=imageUrl;}await axios.put(`${API_BASE_URL}/products/${id}`,updatePayload);alert(\"Product updated successfully\");navigate(\"/goods\");}catch(err){var _err$response,_err$response$data;alert(\"Update failed: \"+(((_err$response=err.response)===null||_err$response===void 0?void 0:(_err$response$data=_err$response.data)===null||_err$response$data===void 0?void 0:_err$response$data.detail)||'Unknown error'));}};if(!product)return/*#__PURE__*/_jsx(\"p\",{className:\"text-center mt-10\",children:\"Loading...\"});return/*#__PURE__*/_jsx(\"div\",{className:\"flex min-h-screen items-center justify-center bg-gray-100 px-4 py-12\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"w-full max-w-md bg-white rounded-xl shadow-lg p-8\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-bold text-center text-gray-900 mb-6\",children:\"Edit Product\"}),/*#__PURE__*/_jsxs(\"form\",{className:\"space-y-5\",onSubmit:handleSubmit,children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700\",children:\"Product Name\"}),/*#__PURE__*/_jsx(\"input\",{name:\"name\",value:formValues.name,onChange:handleChange,required:true,className:\"w-full mt-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-indigo-500\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700\",children:\"Price (\\xA5)\"}),/*#__PURE__*/_jsx(\"input\",{name:\"price\",type:\"number\",value:formValues.price,onChange:handleChange,required:true,className:\"w-full mt-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-indigo-500\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700\",children:\"Category\"}),/*#__PURE__*/_jsx(\"input\",{name:\"category\",value:formValues.category,onChange:handleChange,required:true,className:\"w-full mt-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-indigo-500\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700\",children:\"Stock\"}),/*#__PURE__*/_jsx(\"input\",{name:\"stock\",type:\"number\",value:formValues.stock,onChange:handleChange,required:true,className:\"w-full mt-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-indigo-500\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700\",children:\"Description\"}),/*#__PURE__*/_jsx(\"textarea\",{name:\"description\",value:formValues.description,onChange:handleChange,rows:3,className:\"w-full mt-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-indigo-500\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700\",children:\"Replace Image or PDF (optional)\"}),/*#__PURE__*/_jsx(\"input\",{type:\"file\",accept:\".png,.jpg,.jpeg,.pdf\",onChange:e=>setFile(e.target.files[0]),className:\"mt-1 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border file:border-gray-300 file:text-sm file:bg-white file:text-gray-700 hover:file:bg-gray-50\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between pt-4\",children:[/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"w-full bg-indigo-600 text-white py-2 px-4 rounded-md hover:bg-indigo-500 transition\",children:\"Save Changes\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:()=>navigate('/goods'),className:\"w-full ml-4 bg-gray-300 text-gray-700 py-2 px-4 rounded-md hover:bg-gray-400 transition\",children:\"Cancel\"})]})]})]})});}","map":{"version":3,"names":["React","useEffect","useState","axios","useNavigate","useParams","jsx","_jsx","jsxs","_jsxs","EditProductPage","_ref","user","product","setProduct","file","setFile","formValues","setFormValues","name","price","category","stock","description","id","navigate","API_BASE_URL","get","then","res","target","data","find","p","parseInt","alert","catch","err","handleChange","e","value","handleSubmit","preventDefault","imageUrl","formData","FormData","append","post","headers","updatePayload","username","put","_err$response","_err$response$data","response","detail","className","children","onSubmit","onChange","required","type","rows","accept","files","onClick"],"sources":["/data/ECSite-demo/frontend/src/components/EditProductPage.js"],"sourcesContent":["// src/components/EditProductPage.js\nimport React, { useEffect, useState } from 'react';\nimport axios from 'axios';\nimport { useNavigate, useParams } from 'react-router-dom';\n\nexport default function EditProductPage({ user }) {\n  const [product, setProduct] = useState(null);\n  const [file, setFile] = useState(null);\n  const [formValues, setFormValues] = useState({\n    name: '', price: '', category: '', stock: '', description: ''\n  });\n  const { id } = useParams();\n  const navigate = useNavigate();\n  const API_BASE_URL = \"/api\";\n\n\n  useEffect(() => {\n    axios.get(`${API_BASE_URL}/products`)\n      .then(res => {\n        const target = res.data.find(p => p.id === parseInt(id));\n        if (!target) {\n          alert('Product not found');\n          navigate('/goods');\n          return;\n        }\n        setProduct(target);\n        setFormValues({\n          name: target.name,\n          price: target.price,\n          category: target.category,\n          stock: target.stock,\n          description: target.description || ''\n        });\n      })\n      .catch(err => alert('Failed to load product'));\n  }, [id]);\n\n  const handleChange = (e) => {\n    setFormValues({ ...formValues, [e.target.name]: e.target.value });\n  };\n\n  const handleSubmit = async (e) => {\n    e.preventDefault();\n\n    try {\n      let imageUrl = null;\n\n      // 1. Upload file if provided\n      if (file) {\n        const formData = new FormData();\n        formData.append(\"file\", file);\n        const res = await axios.post(`${API_BASE_URL}/upload-file`, formData, {\n          headers: { 'Content-Type': 'multipart/form-data' }\n        });\n        imageUrl = res.data.imageUrl;\n      }\n\n      // 2. Update product info\n      const updatePayload = {\n        ...formValues,\n        username: user.username,\n      };\n      if (imageUrl) {\n        updatePayload.imageUrl = imageUrl;\n      }\n\n      await axios.put(`${API_BASE_URL}/products/${id}`, updatePayload);\n      alert(\"Product updated successfully\");\n      navigate(\"/goods\");\n    } catch (err) {\n      alert(\"Update failed: \" + (err.response?.data?.detail || 'Unknown error'));\n    }\n  };\n\n  if (!product) return <p className=\"text-center mt-10\">Loading...</p>;\n\n  return (\n    <div className=\"flex min-h-screen items-center justify-center bg-gray-100 px-4 py-12\">\n      <div className=\"w-full max-w-md bg-white rounded-xl shadow-lg p-8\">\n        <h2 className=\"text-2xl font-bold text-center text-gray-900 mb-6\">Edit Product</h2>\n        <form className=\"space-y-5\" onSubmit={handleSubmit}>\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700\">Product Name</label>\n            <input\n              name=\"name\"\n              value={formValues.name}\n              onChange={handleChange}\n              required\n              className=\"w-full mt-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-indigo-500\"\n            />\n          </div>\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700\">Price (Â¥)</label>\n            <input\n              name=\"price\"\n              type=\"number\"\n              value={formValues.price}\n              onChange={handleChange}\n              required\n              className=\"w-full mt-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-indigo-500\"\n            />\n          </div>\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700\">Category</label>\n            <input\n              name=\"category\"\n              value={formValues.category}\n              onChange={handleChange}\n              required\n              className=\"w-full mt-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-indigo-500\"\n            />\n          </div>\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700\">Stock</label>\n            <input\n              name=\"stock\"\n              type=\"number\"\n              value={formValues.stock}\n              onChange={handleChange}\n              required\n              className=\"w-full mt-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-indigo-500\"\n            />\n          </div>\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700\">Description</label>\n            <textarea\n              name=\"description\"\n              value={formValues.description}\n              onChange={handleChange}\n              rows={3}\n              className=\"w-full mt-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-indigo-500\"\n            />\n          </div>\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700\">Replace Image or PDF (optional)</label>\n            <input\n              type=\"file\"\n              accept=\".png,.jpg,.jpeg,.pdf\"\n              onChange={e => setFile(e.target.files[0])}\n              className=\"mt-1 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border file:border-gray-300 file:text-sm file:bg-white file:text-gray-700 hover:file:bg-gray-50\"\n            />\n          </div>\n\n          <div className=\"flex justify-between pt-4\">\n            <button\n              type=\"submit\"\n              className=\"w-full bg-indigo-600 text-white py-2 px-4 rounded-md hover:bg-indigo-500 transition\"\n            >\n              Save Changes\n            </button>\n            <button\n              type=\"button\"\n              onClick={() => navigate('/goods')}\n              className=\"w-full ml-4 bg-gray-300 text-gray-700 py-2 px-4 rounded-md hover:bg-gray-400 transition\"\n            >\n              Cancel\n            </button>\n          </div>\n        </form>\n      </div>\n    </div>\n  );\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}